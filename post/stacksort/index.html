<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <meta name="generator" content="Hugo 0.76.3" />
  <link rel="canonical" href="https://davidbuckley.ca/post/stacksort/">

  

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#000000">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="https://davidbuckley.ca/css/prism.css" media="none" onload="this.media='all';">

  
  
  <link rel="stylesheet" type="text/css" href="https://davidbuckley.ca/css/styles.css">

  <link rel="stylesheet" href="https://davidbuckley.ca/css/code.css"><link rel="stylesheet" href="https://davidbuckley.ca/css/general.css">

  <style id="inverter" media="none">
    .intro-and-nav, .main-and-footer { filter: invert(100%) }
    * { background-color: inherit }
    img:not([src*=".svg"]), .colors, iframe, .demo-container { filter: invert(100%) }
  </style>

  
  
  <title>StackSort | David Buckley</title>
</head>

  <body>
    <a href="#main">skip to content</a>
    <svg style="display: none">
  <symbol id="bookmark" viewBox="0 0 40 50">
   <g transform="translate(2266 3206.2)">
    <path style="stroke:currentColor;stroke-width:3.2637;fill:none" d="m-2262.2-3203.4-.2331 42.195 16.319-16.318 16.318 16.318.2331-42.428z"/>
   </g>
  </symbol>

  <symbol id="w3c" viewBox="0 0 127.09899 67.763">
   <text font-size="83" style="font-size:83px;font-family:Trebuchet;letter-spacing:-12;fill-opacity:0" letter-spacing="-12" y="67.609352" x="-26.782778">W3C</text>
   <text font-size="83" style="font-size:83px;font-weight:bold;font-family:Trebuchet;fill-opacity:0" y="67.609352" x="153.21722" font-weight="bold">SVG</text>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m33.695.377 12.062 41.016 12.067-41.016h8.731l-19.968 67.386h-.831l-12.48-41.759-12.479 41.759h-.832l-19.965-67.386h8.736l12.061 41.016 8.154-27.618-3.993-13.397h8.737z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m91.355 46.132c0 6.104-1.624 11.234-4.862 15.394-3.248 4.158-7.45 6.237-12.607 6.237-3.882 0-7.263-1.238-10.148-3.702-2.885-2.47-5.02-5.812-6.406-10.022l6.82-2.829c1.001 2.552 2.317 4.562 3.953 6.028 1.636 1.469 3.56 2.207 5.781 2.207 2.329 0 4.3-1.306 5.909-3.911 1.609-2.606 2.411-5.738 2.411-9.401 0-4.049-.861-7.179-2.582-9.399-1.995-2.604-5.129-3.912-9.397-3.912h-3.327v-3.991l11.646-20.133h-14.062l-3.911 6.655h-2.493v-14.976h32.441v4.075l-12.31 21.217c4.324 1.385 7.596 3.911 9.815 7.571 2.22 3.659 3.329 7.953 3.329 12.892z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.21 0 1.414 8.6-5.008 9.583s-1.924-4.064-5.117-6.314c-2.693-1.899-4.447-2.309-7.186-1.746-3.527.73-7.516 4.938-9.258 10.13-2.084 6.21-2.104 9.218-2.178 11.978-.115 4.428.58 7.043.58 7.043s-3.04-5.626-3.011-13.866c.018-5.882.947-11.218 3.666-16.479 2.404-4.627 5.954-7.404 9.114-7.728 3.264-.343 5.848 1.229 7.841 2.938 2.089 1.788 4.213 5.698 4.213 5.698l4.94-9.837z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.82 48.674s-2.208 3.957-3.589 5.48c-1.379 1.524-3.849 4.209-6.896 5.555-3.049 1.343-4.646 1.598-7.661 1.306-3.01-.29-5.807-2.032-6.786-2.764-.979-.722-3.486-2.864-4.897-4.854-1.42-2-3.634-5.995-3.634-5.995s1.233 4.001 2.007 5.699c.442.977 1.81 3.965 3.749 6.572 1.805 2.425 5.315 6.604 10.652 7.545 5.336.945 9.002-1.449 9.907-2.031.907-.578 2.819-2.178 4.032-3.475 1.264-1.351 2.459-3.079 3.116-4.108.487-.758 1.276-2.286 1.276-2.286l-1.276-6.644z"/>
  </symbol>

  <symbol id="tag" viewBox="0 0 177.16535 177.16535">
    <g transform="translate(0 -875.2)">
     <path style="fill-rule:evenodd;stroke-width:0;fill:currentColor" d="m159.9 894.3-68.79 8.5872-75.42 77.336 61.931 60.397 75.429-76.565 6.8495-69.755zm-31.412 31.835a10.813 10.813 0 0 1 1.8443 2.247 10.813 10.813 0 0 1 -3.5174 14.872l-.0445.0275a10.813 10.813 0 0 1 -14.86 -3.5714 10.813 10.813 0 0 1 3.5563 -14.863 10.813 10.813 0 0 1 13.022 1.2884z"/>
    </g>
  </symbol>

  <symbol id="balloon" viewBox="0 0 141.73228 177.16535">
   <g transform="translate(0 -875.2)">
    <g>
     <path style="fill:currentColor" d="m68.156 882.83-.88753 1.4269c-4.9564 7.9666-6.3764 17.321-5.6731 37.378.36584 10.437 1.1246 23.51 1.6874 29.062.38895 3.8372 3.8278 32.454 4.6105 38.459 4.6694-.24176 9.2946.2879 14.377 1.481 1.2359-3.2937 5.2496-13.088 8.886-21.623 6.249-14.668 8.4128-21.264 10.253-31.252 1.2464-6.7626 1.6341-12.156 1.4204-19.764-.36325-12.93-2.1234-19.487-6.9377-25.843-2.0833-2.7507-6.9865-7.6112-7.9127-7.8436-.79716-.20019-6.6946-1.0922-6.7755-1.0248-.02213.0182-5.0006-.41858-7.5248-.22808l-2.149-.22808h-3.3738z"/>
     <path style="fill:currentColor" d="m61.915 883.28-3.2484.4497c-1.7863.24724-3.5182.53481-3.8494.63994-2.4751.33811-4.7267.86957-6.7777 1.5696-.28598 0-1.0254.20146-2.3695.58589-5.0418 1.4418-6.6374 2.2604-8.2567 4.2364-6.281 7.6657-11.457 18.43-12.932 26.891-1.4667 8.4111.71353 22.583 5.0764 32.996 3.8064 9.0852 13.569 25.149 22.801 37.517 1.3741 1.841 2.1708 2.9286 2.4712 3.5792 3.5437-1.1699 6.8496-1.9336 10.082-2.3263-1.3569-5.7831-4.6968-21.86-6.8361-33.002-.92884-4.8368-2.4692-14.322-3.2452-19.991-.68557-5.0083-.77707-6.9534-.74159-15.791.04316-10.803.41822-16.162 1.5026-21.503 1.4593-5.9026 3.3494-11.077 6.3247-15.852z"/>
     <path style="fill:currentColor" d="m94.499 885.78c-.10214-.0109-.13691 0-.0907.0409.16033.13489 1.329 1.0675 2.5976 2.0723 6.7003 5.307 11.273 14.568 12.658 25.638.52519 4.1949.24765 14.361-.5059 18.523-2.4775 13.684-9.7807 32.345-20.944 53.519l-3.0559 5.7971c2.8082.76579 5.7915 1.727 8.9926 2.8441 11.562-11.691 18.349-19.678 24.129-28.394 7.8992-11.913 11.132-20.234 12.24-31.518.98442-10.02-1.5579-20.876-6.7799-28.959-.2758-.4269-.57803-.86856-.89617-1.3166-3.247-6.13-9.752-12.053-21.264-16.131-2.3687-.86369-6.3657-2.0433-7.0802-2.1166z"/>
     <path style="fill:currentColor" d="m32.52 892.22c-.20090-.13016-1.4606.81389-3.9132 2.7457-11.486 9.0476-17.632 24.186-16.078 39.61.79699 7.9138 2.4066 13.505 5.9184 20.562 5.8577 11.77 14.749 23.219 30.087 38.74.05838.059.12188.1244.18052.1838 1.3166-.5556 2.5965-1.0618 3.8429-1.5199-.66408-.32448-1.4608-1.3297-3.8116-4.4602-5.0951-6.785-8.7512-11.962-13.051-18.486-5.1379-7.7948-5.0097-7.5894-8.0586-13.054-6.2097-11.13-8.2674-17.725-8.6014-27.563-.21552-6.3494.13041-9.2733 1.775-14.987 2.1832-7.5849 3.9273-10.986 9.2693-18.07 1.7839-2.3656 2.6418-3.57 2.4409-3.7003z"/>
     <path style="fill:currentColor" d="m69.133 992.37c-6.2405.0309-12.635.76718-19.554 2.5706 4.6956 4.7759 9.935 10.258 12.05 12.625l4.1272 4.6202h11.493l3.964-4.4516c2.0962-2.3541 7.4804-7.9845 12.201-12.768-8.378-1.4975-16.207-2.6353-24.281-2.5955z"/>
     <rect style="stroke-width:0;fill:currentColor" ry="2.0328" height="27.746" width="22.766" y="1017.7" x="60.201"/>
    </g>
   </g>
  </symbol>

  <symbol id="info" viewBox="0 0 41.667 41.667">
   <g transform="translate(-37.035 -1004.6)">
    <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m76.25 1030.2a18.968 18.968 0 0 1 -23.037 13.709 18.968 18.968 0 0 1 -13.738 -23.019 18.968 18.968 0 0 1 23.001 -13.768 18.968 18.968 0 0 1 13.798 22.984"/>
    <g transform="matrix(1.1146 0 0 1.1146 -26.276 -124.92)">
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m75.491 1039.5v-8.7472"/>
     <path style="stroke-width:0;fill:currentColor" transform="scale(-1)" d="m-73.193-1024.5a2.3719 2.3719 0 0 1 -2.8807 1.7142 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
   </g>
  </symbol>

  <symbol id="warning" viewBox="0 0 48.430474 41.646302">
    <g transform="translate(-1.1273 -1010.2)">
     <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:4.151;fill:none" d="m25.343 1012.3-22.14 37.496h44.28z"/>
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:4.1512;fill:none" d="m25.54 1027.7v8.7472"/>
     <path style="stroke-width:0;fill:currentColor" d="m27.839 1042.8a2.3719 2.3719 0 0 1 -2.8807 1.7143 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
  </symbol>

  <symbol id="menu" viewBox="0 0 50 50">
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="0" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="20" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="40" x="0"/>
   </symbol>

   <symbol id="link" viewBox="0 0 50 50">
    <g transform="translate(0 -1002.4)">
     <g transform="matrix(.095670 0 0 .095670 2.3233 1004.9)">
      <g>
       <path style="stroke-width:0;fill:currentColor" d="m452.84 192.9-128.65 128.65c-35.535 35.54-93.108 35.54-128.65 0l-42.881-42.886 42.881-42.876 42.884 42.876c11.845 11.822 31.064 11.846 42.886 0l128.64-128.64c11.816-11.831 11.816-31.066 0-42.9l-42.881-42.881c-11.822-11.814-31.064-11.814-42.887 0l-45.928 45.936c-21.292-12.531-45.491-17.905-69.449-16.291l72.501-72.526c35.535-35.521 93.136-35.521 128.64 0l42.886 42.881c35.535 35.523 35.535 93.141-.001 128.66zm-254.28 168.51-45.903 45.9c-11.845 11.846-31.064 11.817-42.881 0l-42.884-42.881c-11.845-11.821-11.845-31.041 0-42.886l128.65-128.65c11.819-11.814 31.069-11.814 42.884 0l42.886 42.886 42.876-42.886-42.876-42.881c-35.54-35.521-93.113-35.521-128.65 0l-128.65 128.64c-35.538 35.545-35.538 93.146 0 128.65l42.883 42.882c35.51 35.54 93.11 35.54 128.65 0l72.496-72.499c-23.956 1.597-48.092-3.784-69.474-16.283z"/>
      </g>
     </g>
    </g>
  </symbol>

  <symbol id="doc" viewBox="0 0 35 45">
   <g transform="translate(-147.53 -539.83)">
    <path style="stroke:currentColor;stroke-width:2.4501;fill:none" d="m149.38 542.67v39.194h31.354v-39.194z"/>
    <g style="stroke-width:25" transform="matrix(.098003 0 0 .098003 133.69 525.96)">
     <path d="m220 252.36h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path style="stroke:currentColor;stroke-width:25;fill:none" d="m220 409.95h200"/>
     <path d="m220 488.74h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path d="m220 331.15h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
    </g>
   </g>
 </symbol>

 <symbol id="tick" viewBox="0 0 177.16535 177.16535">
  <g transform="translate(0 -875.2)">
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="155" width="40" y="702.99" x="556.82"/>
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="40" width="90.404" y="817.99" x="506.42"/>
  </g>
 </symbol>
</svg>

    <div class="wrapper">
      <header class="intro-and-nav" role="banner">
  <div>
    <div class="intro">
      <a
        class="logo"
        href="https://davidbuckley.ca"
        aria-label="David Buckley home page"
      >
        <img src="https://davidbuckley.ca/images/logo.svg" alt="">
      </a>
      <p class="library-desc">
         I write code. 
      </p>
    </div>
    <nav id="patterns-nav" class="patterns" role="navigation">
  <h2 class="vh">Main navigation</h2>
  <button id="menu-button" aria-expanded="false">
    <svg viewBox="0 0 50 50" aria-hidden="true" focusable="false">
      <use xlink:href="#menu"></use>
    </svg>
    Menu
  </button>
  
  <ul id="patterns-list">
  
    <li class="pattern">
      
      
      
      
      <a href="/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">Home</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/post/" aria-current="page">
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">Blog</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/about/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">About</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/index.xml" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">RSS</span>
      </a>
    </li>
  
  </ul>
</nav>
  </div>
</header>

      <div class="main-and-footer">
        <div>
  <label for="themer">
    dark theme: <input type="checkbox" id="themer" class="vh">
    <span aria-hidden="true"></span>
  </label>
</div>

        <div>
          
  <main id="main">
    <h1>
      <svg class="bookmark-icon" aria-hidden="true" viewBox="0 0 40 50" focusable="false">
        <use xlink:href="#bookmark"></use>
      </svg>
      StackSort
    </h1>

    <div class="date">
      
      
      <strong>Publish date: </strong>Oct 10, 2020
      
        
      
    </div>

    
      <div class="tags">
        <strong>Tags: </strong>
        <ul aria-label="tags">
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use xlink:href="#tag"></use>
              </svg>
              
              <a href="https://davidbuckley.ca/tags/demo/">demo</a>
            </li>
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use xlink:href="#tag"></use>
              </svg>
              
              <a href="https://davidbuckley.ca/tags/python/">python</a>
            </li>
          
        </ul>
      </div>
    
    
    
      

  <nav class="toc" aria-labelledby="toc-heading">
    <h2 id="toc-heading">Table of contents</h2>
    <ol>
      
        <li>
          
          
          
          
          <a href="#background">
            Background
          </a>
        </li>
      
        <li>
          
          
          
          
          <a href="#hooking-the-import-system">
            Hooking the Import System
          </a>
        </li>
      
        <li>
          
          
          
          
          <a href="#fetching-code">
            Fetching Code
          </a>
        </li>
      
        <li>
          
          
          
          
          <a href="#dynamic-compilation-and-execution">
            Dynamic Compilation and Execution
          </a>
        </li>
      
        <li>
          
          
          
          
          <a href="#trying-it-out">
            Trying it Out
          </a>
        </li>
      
    </ol>
  </nav>


    

    <aside aria-label="warning" class="note warning">
  <div>
    <svg class="sign" aria-hidden="true" viewBox="0 0 48.430474 41.646302" focusable="false">
      <use xlink:href="#warning"></use>
    </svg>
    
Running arbitrary untrusted code is a bad idea, use your head.

  </div>
</aside>

<p>You can find the source for stacksort <a href="https://github.com/buckley-w-david/stacksort">here</a>.</p>
<h2 id="background">Background</h2>
<p>This project was inspired by the XKCD comic <a href="https://xkcd.com/1185/">Ineffective Sorts</a> and the similar project by Gregory Koberger, <a href="https://gkoberger.github.io/stacksort/">stacksort</a>.</p>
<p><img src="https://imgs.xkcd.com/comics/ineffective_sorts.png" alt="Ineffective Sorts"></p>


<blockquote class="blockquote">
  <p>
    StackSort connects to StackOverflow, searches for &lsquo;sort a list&rsquo;, and downloads and runs code snippets until the list is sorted.
    
      <br>
      <span class="author">&mdash; Randall Munroe</span>
    
  </p>
</blockquote>
<p>I wanted to be able to download and run code from StackOverflow the same way I would use any normal Python package.</p>




<div class="code-annotated "><code>
from stacksort import quicksort
.
.
.
</code></div>

<p>Before getting into the details, might I suggest taking a peak at <a href="#trying-it-out">Trying it Out</a>?</p>
<h2 id="hooking-the-import-system">Hooking the Import System</h2>
<p>Code can by found <a href="https://github.com/buckley-w-david/stacksort/blob/master/stacksort/_meta/injector.py">here</a> (<code>StackSortFinder</code> and <code>StackSortLoader</code>) and <a href="https://github.com/buckley-w-david/stacksort/blob/master/stacksort/__init__.py">here</a>.</p>
<p>Most of what I needed I figured out by reading <a href="https://dev.to/dangerontheranger/dependency-injection-with-import-hooks-in-python-3-5hap">this blog post</a>, and the rest of some trial and error. It&rsquo;s actually not that difficult to hook the import system, it came down to defining two very simple classes.</p>




<div class="code-annotated "><code>
class StackSortFinder(importlib.abc.MetaPathFinder):
    _COMMON_PREFIX = &#34;stacksort.&#34;

    def __init__(self, loader):
        self._loader = loader

    def find_spec(self, fullname, path, target=None):
        if fullname.startswith(self._COMMON_PREFIX):
            name = fullname[len(self._COMMON_PREFIX):]
            return self._gen_spec(name)

    def _gen_spec(self, fullname):
        return importlib.machinery.ModuleSpec(fullname, self._loader)
</code></div>

<!--_ VIM doesn't realize that the underscores in there don't mean it should italicise-->
<p><code>find_spec</code> needs to return a <a href="https://docs.python.org/3/library/importlib.html#importlib.machinery.ModuleSpec"><code>ModuleSpec</code></a> to intercept the import (Not returning anything means the import is not intercepted).</p>
<p><code>from stacksort import quicksort</code> will generate a <code>fullname</code> of <code>stacksort.quicksort</code>, so we check for and strip off the prefix <code>stacksort.</code>, return the <code>ModuleSpec</code>.</p>




<div class="code-annotated "><code>
class StackSortLoader(importlib.abc.Loader):
    def create_module(self, spec):
        return StackOverflowStuff(spec.name)

    def exec_module(self, module):
        pass
</code></div>

<p>The loader needs two methods, <code>create_module</code> and <code>exec_module</code>. We&rsquo;re not doing anything that requires the <code>exec_module</code> method so it&rsquo;s a noop.</p>
<p><code>create_module</code> returns <em>something</em> that will do the actual work of fetching and compiling StackOverflow code. This is the object that the user gets from importing. We can use <code>spec.name</code> to access the name of what the user was trying to import so we can use that to search for the right code.</p>
<p>The code is located in in <code>_meta/...</code>. This is to prevent name collisions when a user of the package is trying to import something, since if Python can locate an object with the right name, it will never use our custom <code>MetaPathFinder</code>. Unlikely to happen unless we call our modules something like <code>quicksort</code>, but I figured it was better to hide them behind something more obscure.</p>




<div class="code-annotated "><code>
from stacksort._meta import injector
import sys

loader = injector.StackSortLoader()
finder = injector.StackSortFinder(loader)
sys.meta_path.append(finder)
</code></div>

<p>After those are defined it&rsquo;s a matter of instantiating both classes and adding our finder to <code>sys.meta_path</code>.</p>
<p>Viola! The import system has been hooked.</p>
<p>By putting the above code chunk in the package&rsquo;s <code>__init__.py</code> file, it runs on package import, before python tries to import anything else. This means that there&rsquo;s no explicit setup step that an importer needs to run, the import hooking Just Works™.</p>
<h2 id="fetching-code">Fetching Code</h2>
<p><a href="https://github.com/buckley-w-david/stacksort/blob/master/stacksort/_meta/stackoverflow/find.py">Code can be found here</a></p>
<p>This part was nothing novel, after a half-second of searching I found <a href="https://stackapi.readthedocs.io/en/latest/">stackapi</a>, which let me leverage the <a href="https://api.stackexchange.com/">StackExchange API</a>.</p>
<p>The main thrust is the following:</p>
<ol>
<li>Search of questions tagged with &lsquo;python&rsquo; and &lsquo;sorting&rsquo;, and use whatever the user was trying to import (&ldquo;quicksort&rdquo; for instance) as the mysterious &ldquo;q&rdquo; parameter.<br>
The &ldquo;q&rdquo; paramter is &ldquo;a free form text parameter, will match all question properties based on an undocumented algorithm&rdquo;.</li>
<li>Fetch the answers to the questions returned from that search.</li>
<li>loop through those answers, extracting and returning code blocks.</li>
</ol>
<p>Aside from that is some further bookkeeping involved:</p>
<ul>
<li>Fetching more questions/answers if no appropriate ones were found.</li>
<li>if a <code>safety_date</code> has been provided (The default is that the date I put it up on GitHub is used), don&rsquo;t accept any questions/answers that were posted (or edited) after that date. This is a cue I took from Gregory Koberger&rsquo;s implementation that improves safety a bit since it prevents anyone from specifically targetting this library with malicious code since nobody knew about it before now.</li>
<li>The function <code>yield</code>s the code blocks as it extracts them. This pattern makes it easy to consume all the code blocks by iterating over the generator returned by calling the function.</li>
<li>A friend of mine suggested having the ability to randomize the order of results in some way so that it&rsquo;s not as likely you&rsquo;ll hit the same answer every time. Support for this isn&rsquo;t really fleshed out by there is an option to shuffle the answers.</li>
<li>The StackExchange API has a neat concept of filters to request only specific fields. I&rsquo;m using that to significanly cut down on the amount of data that needs to be downloaded.</li>
</ul>
<h2 id="dynamic-compilation-and-execution">Dynamic Compilation and Execution</h2>
<p>The fun part!</p>
<p>Code can be found <a href="https://github.com/buckley-w-david/stacksort/blob/master/stacksort/_meta/injector.py">here</a> (StackSortRunner) and <a href="https://github.com/buckley-w-david/stacksort/blob/master/stacksort/_meta/compile.py">here</a></p>
<p>From my previous project trying working on <a href="https://davidbuckley.ca/post/string-interpolation-and-sql/" title="String Interpolation and SQL">automatic SQL query parameterization</a>, I had some experience with dynamic code generation, so I generally knew what I was doing and didn&rsquo;t need to go read blog posts to figure it out.</p>
<p>There are a bunch of small details and hueristics I needed to come up with, but at a high level this is what happens:</p>
<ol>
<li>The loader from our import hooking returns a <code>StackSortRunner</code>.</li>
<li><code>StackSortRunner</code> has a <code>__call__</code> method that iterates over code blocks return from the fetching section.</li>
<li>The code block is sent to the enigmatic <code>compile.compile_sorter</code> function, this returns a callable object.</li>
<li>The returned object is called, the unsorted list is passed to it as an argument.</li>
<li>If none of that caused an exception, a reference to that &ldquo;working&rdquo; object is stored, and the result of its execution is returned. Anytime the <code>StackSortRunner</code> is called in the future that &ldquo;working&rdquo; version will be used without performing another search.</li>
</ol>
<p>All of the complexity here is in <code>compile.compile_sorter</code>.</p>
<h3 id="code-generation-and-manipulation">Code Generation and Manipulation</h3>
<p>To start, the code is run through through <a href="https://docs.python.org/3/library/2to3.html#module-lib2to3">lib2to3</a>. Even though the question search excludes questions tagged as <code>python-2.x</code>, some still slip through. I got annoyed that simple things like the changes to print was preventing perfectly good submissions from parsing, so first thing the code is run through <code>lib2to3.refactor.RefactoringTool.refactor_string</code>.</p>
<p>The code is then parsed into an AST using <code>ast.parse</code>. Simple enough, nothing interesting there.</p>
<p>Then we get into the heuristics and manipulations.</p>
<hr>
<p><code>print</code> calls are removed, these are pretty common in StackOverflow answers since they&rsquo;re meant to be demonstrations, but who wants their sorting functions to print?</p>
<p>This is done using an <code>ast.NodeTransformer</code>. All expressions in the AST are visted, and any that are:</p>
<ol>
<li><code>_ast.Expr</code> instances</li>
<li>Which has an <code>_ast.Call</code> instance as its <code>value</code></li>
<li>Which has an <code>_ast.Name</code> value as its <code>func</code></li>
<li>Which has an <code>id == &quot;print&quot;</code></li>
</ol>
<p>Are removed from the tree.</p>
<hr>
<p>The AST is then scanned, to see if it defines any functions at the top level.</p>
<pre><code>if not any(isinstance(node, _ast.FunctionDef) for node in new_tree.body):
    ...
</code></pre><p>If it does define at least one function, it is compiled and passed into an instance of <code>StackRunner</code> which takes things from there:</p>
<pre><code>    ...
        compiled_code = compile(ast.fix_missing_locations(new_tree), '&lt;StackOverflow&gt;', 'exec')
    except Exception as exc:
        raise

    return StackRunner(tree, compiled_code)
</code></pre><p>This handles the case where the answer is in the form of a function that performs the sort</p>
<pre><code>def quicksort(unsorted_list):
    ...
    return sorted_list
</code></pre><hr>
<p>What is still left to handle is when the answer provides code to sort the list just in terms of top level operations, identified as when no top level functions are defined.</p>
<p>To handle this case, the code is wrapped in a function before compilation. To do this a few things are required.</p>
<h4 id="figure-out-what-to-call-the-parameter">Figure out what to call the parameter</h4>
<p>Since each code block may name it&rsquo;s unsorted list differently, and whatever name it chooses we will need to use for the name of the list parameter of the wrapping function, we need to scan the code and try to figure out what it&rsquo;s called.</p>
<p>Originally the plan was:</p>
<ul>
<li>Scan for usages of variables that have not been declared
<ul>
<li>If there is 1, you have found the parameter name</li>
<li>If there are 0, look for a variable that was initialized to a list</li>
<li>If there are more than 1, abort</li>
</ul>
</li>
</ul>
<p>But once I actually got to that, I found that &ldquo;Scan for usages of variables that have not been declared&rdquo; is harder than it might first seem.</p>
<p>Ultimately I gave up on this approach and decided that any top level variable initialized to a non-empty list is our parameter, the idea is that most of these answers initialize a &ldquo;seed&rdquo; list to run through the algorithm, which this would find.</p>
<p>If no variable initialization matching this criteria can be found, the attempt to use this code block is aborted.</p>
<p>To prevent our unsorted list passed as an argument from being clobbered by that list initialization, we also remove all AST nodes that assign to this variable using a very similar methodology to removing the print calls.</p>
<h4 id="figure-out-what-to-return">Figure out what to return</h4>
<p>Deciding what to return is not complicated, although the accuracy of the technique is not great. Any top level variable initialized to a empty list is the value that is returned. If nothing matching that criteria can be found, it is assumed that the input list is sorted in-place and the parameter from the above step is returned.</p>
<h4 id="wrap-it-up">Wrap it Up</h4>
<p>The existing AST is embedded within a manually initialized <code>ast.FunctionDef</code> that has the correct parameter and a return statement.</p>
<p>This new AST is then used in the place of the original and treated the same as when the code block does define its own function.</p>
<h3 id="the-home-stretch">The Home Stretch</h3>
<p>The last remaining piece is the <code>StackRunner</code> class.</p>
<p>Now that we have compiled the code block into something that we may be able to use, it is time to actually execute it.</p>
<pre><code>exec(compiled_code, globals())
</code></pre><p>Because of the code generation/manipulation work, we know now that there is now at least one function defined (in the module&rsquo;s global scope).</p>
<p>The next thing to figure out is <em>which function</em>?</p>
<p>The code block many (and often does) define multiple functions, so we now scan the AST for <em>entrypoints</em>.</p>
<pre><code>def valid_signature(func_def: _ast.FunctionDef):
    # Only 1 function argument, or only 1 that isn't given a default value
    return len(func_def.args.args) == 1 or len(func_def.args.args) - len(func_def.args.defaults) == 1

def entrypoints(tree: _ast.Module):
    return [
        f.name
        for f in tree.body
        if isinstance(f, _ast.FunctionDef) and valid_signature(f)
    ]
</code></pre><p>This returns the names of all functions that the code block defined that either accept one argument (hopefully the unsorted list), or only one argument that isn&rsquo;t given a default value.</p>
<p>Finally these functions are retrieved from the global scope, and called with the unsorted list passed as a parameter. If it doesn&rsquo;t explode, the function is stored and used on any subsequent calls.
If none of the functions worked, a <code>NoValidCodeError</code> is thrown, and the loader moves on to the next code block.</p>
<h2 id="trying-it-out">Trying it Out</h2>
<p>You can try it yourself in the safety of a Jupyter Notebook in your browser by checking it out on Binder.</p>
<p><a href="https://mybinder.org/v2/gh/buckley-w-david/stacksort/master"><img src="https://mybinder.org/badge_logo.svg" alt="Binder"></a></p>
<h3 id="setup">Setup</h3>
<p>By default the package does all it&rsquo;s work silently, but by setting the <code>logLevel</code> to <code>DEBUG</code> you can see what code it&rsquo;s trying to run.</p>
<pre><code>&gt;&gt;&gt; from stacksort import config
&gt;&gt;&gt; import logging
&gt;&gt;&gt; logging.basicConfig(level=logging.DEBUG)
&gt;&gt;&gt; config.logger.setLevel(logging.DEBUG)
&gt;&gt;&gt; from random import shuffle
&gt;&gt;&gt; l = list(range(100))
&gt;&gt;&gt; shuffle(l)
&gt;&gt;&gt; print(l)
[36, 53, 19, 26, 24, 74, 65, 3, 77, 47, 5, 29, 18, 15, 12, 45, 8, 31, 92, 2, 42, 90, 52, 89, 97, 55, 41, 9, 63, 87, 71, 69, 39, 58, 17, 28, 16, 94, 49, 21, 6, 96, 81, 25, 75, 7, 85, 80, 61, 46, 73, 13, 33, 34, 23, 62, 44, 32, 68, 78, 54, 57, 67, 56, 1, 60, 79, 4, 11, 86, 51, 43, 76, 10, 20, 95, 88, 84, 38, 91, 72, 40, 37, 82, 99, 83, 35, 22, 98, 64, 59, 14, 30, 27, 0, 93, 50, 48, 70, 66]
</code></pre><div class="expandable-section">
  
    <h2>
  
    
    
    
    
    
    <button aria-expanded="false" data-expands="js-expandable-ade985e5cc95db6dc46cad4ce0f139c8">
      <span class="expandable-label">QuickSort</span>
      <svg aria-hidden="true" focusable="false" viewBox="0 0 70.866142 70.866141">
        <g transform="translate(0 -981.5)">
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="60" width="9.8985" y="987.36" x="30.051" class="up-strut" />
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="10" width="60" y="1012.4" x="5"/>
        </g>
      </svg>
    </button>
  
    </h2>
  
  <div id="js-expandable-ade985e5cc95db6dc46cad4ce0f139c8" hidden>
    <pre><code>&gt;&gt;&gt; from stacksort import quicksort
&gt;&gt;&gt; sorted_list = quicksort(l)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.stackexchange.com:443
DEBUG:urllib3.connectionpool:https://api.stackexchange.com:443 &quot;GET /2.2/search/advanced/?pagesize=50&amp;page=1&amp;filter=%21b93xdWqUwqOO7m&amp;order=desc&amp;sort=relevance&amp;q=quicksort&amp;nottagged=python-2.x&amp;tagged=python&amp;tagged=sorting&amp;todate=1601424000&amp;site=stackoverflow HTTP/1.1&quot; 200 847
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.stackexchange.com:443
DEBUG:urllib3.connectionpool:https://api.stackexchange.com:443 &quot;GET /2.2/questions/18262306;41893866;9865374;52148522;21986065;35118022;35877642;26634593;38685665;25690175;59229833;36972714;31399021;27572698;50084073;50896944;63890263;54723733;31419302;53225679;13900894;17773516;28442837;59581472;39657307;47128070;10039821;62124146;13384473;61382822;21223035;22621039;26705309;26071867;61259485;26753209;25105541;17659974;43689308/answers/?pagesize=50&amp;page=1&amp;filter=-XG6tqDiasfBQHS1&amp;order=desc&amp;sort=votes&amp;todate=1601424000&amp;site=stackoverflow HTTP/1.1&quot; 200 16913
DEBUG:stacksort._meta.injector:CODE BLOCK

def sort(array=[12,4,5,6,7,3,1,15]):
    &quot;&quot;&quot;Sort the array by using quicksort.&quot;&quot;&quot;

    less = []
    equal = []
    greater = []

    if len(array) &gt; 1:
        pivot = array[0]
        for x in array:
            if x &lt; pivot:
                less.append(x)
            elif x == pivot:
                equal.append(x)
            elif x &gt; pivot:
                greater.append(x)
        # Don't forget to return something!
        return sort(less)+equal+sort(greater)  # Just use the + operator to join lists
    # Note that you want equal ^^^^^ not pivot
    else:  # You need to handle the part at the end of the recursion - when you only have one element in your array, just return the array.
        return array



DEBUG:RefactoringTool:Refactoring StackOverflow
&gt;&gt;&gt; print(sorted_list)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99]
</code></pre>
  </div>
</div>

<div class="expandable-section">
  
    <h2>
  
    
    
    
    
    
    <button aria-expanded="false" data-expands="js-expandable-b66dff42d3471c799683e144f6f4a864">
      <span class="expandable-label">MergeSort</span>
      <svg aria-hidden="true" focusable="false" viewBox="0 0 70.866142 70.866141">
        <g transform="translate(0 -981.5)">
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="60" width="9.8985" y="987.36" x="30.051" class="up-strut" />
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="10" width="60" y="1012.4" x="5"/>
        </g>
      </svg>
    </button>
  
    </h2>
  
  <div id="js-expandable-b66dff42d3471c799683e144f6f4a864" hidden>
    <pre><code>&gt;&gt;&gt; from stacksort import mergesort
&gt;&gt;&gt; sorted_list = mergesort(l)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.stackexchange.com:443
DEBUG:urllib3.connectionpool:https://api.stackexchange.com:443 &quot;GET /2.2/search/advanced/?pagesize=50&amp;page=1&amp;filter=%21b93xdWqUwqOO7m&amp;order=desc&amp;sort=relevance&amp;q=mergesort&amp;nottagged=python-2.x&amp;tagged=python&amp;tagged=sorting&amp;todate=1601424000&amp;site=stackoverflow HTTP/1.1&quot; 200 837
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.stackexchange.com:443
DEBUG:urllib3.connectionpool:https://api.stackexchange.com:443 &quot;GET /2.2/questions/18761766;58480851;3752926;36683919;42294202;45961037;31237149;47624555;50972843;50246479;41118705;52755255;46901669;41234102;29113461;61204291;31237499;55752957;13688084;40451156;26456517;32891670;53753296;59372242;44787889;7063697;33976191;47145070;57117592;53999446;34889618;54004903;63965149;25626499;43104990;37368921/answers/?pagesize=50&amp;page=1&amp;filter=-XG6tqDiasfBQHS1&amp;order=desc&amp;sort=votes&amp;todate=1601424000&amp;site=stackoverflow HTTP/1.1&quot; 200 18977
DEBUG:stacksort._meta.injector:CODE BLOCK

def msort2(x):
    if len(x) &lt; 2:
        return x
    result = []          # moved!
    mid = int(len(x) / 2)
    y = msort2(x[:mid])
    z = msort2(x[mid:])
    while (len(y) &gt; 0) and (len(z) &gt; 0):
        if y[0] &gt; z[0]:
            result.append(z[0])
            z.pop(0)
        else:
            result.append(y[0])
            y.pop(0)
    result += y
    result += z
    return result



DEBUG:RefactoringTool:Refactoring StackOverflow
&gt;&gt;&gt; print(sorted_list)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99]
</code></pre>
  </div>
</div>

<div class="expandable-section">
  
    <h2>
  
    
    
    
    
    
    <button aria-expanded="false" data-expands="js-expandable-5e72c3d23db2a6c3d26c78f281dad6ed">
      <span class="expandable-label">InsertionSort</span>
      <svg aria-hidden="true" focusable="false" viewBox="0 0 70.866142 70.866141">
        <g transform="translate(0 -981.5)">
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="60" width="9.8985" y="987.36" x="30.051" class="up-strut" />
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="10" width="60" y="1012.4" x="5"/>
        </g>
      </svg>
    </button>
  
    </h2>
  
  <div id="js-expandable-5e72c3d23db2a6c3d26c78f281dad6ed" hidden>
    <pre><code>&gt;&gt;&gt; from stacksort import insertionsort
&gt;&gt;&gt; sorted_list = insertionsort(l)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.stackexchange.com:443
DEBUG:urllib3.connectionpool:https://api.stackexchange.com:443 &quot;GET /2.2/search/advanced/?pagesize=50&amp;page=1&amp;filter=%21b93xdWqUwqOO7m&amp;order=desc&amp;sort=relevance&amp;q=insertionsort&amp;nottagged=python-2.x&amp;tagged=python&amp;tagged=sorting&amp;todate=1601424000&amp;site=stackoverflow HTTP/1.1&quot; 200 845
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.stackexchange.com:443
DEBUG:urllib3.connectionpool:https://api.stackexchange.com:443 &quot;GET /2.2/questions/26705235;63112915;60422619;23933317;44856376;13267316;42388868;22183315;52962256;61902504;37773862;42697889;47599527;47201984;61683727;42524585;39956663;36863697;36898404;62118839;48661803;45029843;55128804;15509639;26526090;43670480;48364221;15801027;39780946;41924837;30699059;52307347;6972454;56314051;60029505;18709280;8220333/answers/?pagesize=50&amp;page=1&amp;filter=-XG6tqDiasfBQHS1&amp;order=desc&amp;sort=votes&amp;todate=1601424000&amp;site=stackoverflow HTTP/1.1&quot; 200 15486
DEBUG:stacksort._meta.injector:CODE BLOCK

import operator
def insertionSort(L, reverse=False):       
    lt = operator.gt if reverse else operator.lt        
    for j in xrange(1,len(L)):
        valToInsert = L[j]
        i = j-1
        while 0 &lt;= i and lt(valToInsert, L[i]):
            L[i+1] = L[i]
            i -= 1
        L[i+1] = valToInsert
    return L



DEBUG:RefactoringTool:Refactoring StackOverflow
&gt;&gt;&gt; print(sorted_list)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99]
</code></pre>
  </div>
</div>

<div class="expandable-section">
  
    <h2>
  
    
    
    
    
    
    <button aria-expanded="false" data-expands="js-expandable-ae932c355fa8beec0fab886b18aad0e6">
      <span class="expandable-label">SelectionSort</span>
      <svg aria-hidden="true" focusable="false" viewBox="0 0 70.866142 70.866141">
        <g transform="translate(0 -981.5)">
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="60" width="9.8985" y="987.36" x="30.051" class="up-strut" />
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="10" width="60" y="1012.4" x="5"/>
        </g>
      </svg>
    </button>
  
    </h2>
  
  <div id="js-expandable-ae932c355fa8beec0fab886b18aad0e6" hidden>
    <p>It&rsquo;s not always going to give you the kind of result you&rsquo;re expecting.</p>
<pre><code>&gt;&gt;&gt; from stacksort import selectionsort
&gt;&gt;&gt; sorted_list = selectionsort(l)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.stackexchange.com:443
DEBUG:urllib3.connectionpool:https://api.stackexchange.com:443 &quot;GET /2.2/search/advanced/?pagesize=50&amp;page=1&amp;filter=%21b93xdWqUwqOO7m&amp;order=desc&amp;sort=relevance&amp;q=selectionsort&amp;nottagged=python-2.x&amp;tagged=python&amp;tagged=sorting&amp;todate=1601424000&amp;site=stackoverflow HTTP/1.1&quot; 200 828
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.stackexchange.com:443
DEBUG:urllib3.connectionpool:https://api.stackexchange.com:443 &quot;GET /2.2/questions/26705235;19142997;42045293;47721315;22121364;44125156;60168438;54134232;41199580;19935082;15163913;21771964;57382687;62051579;52695051;19199874;42034278;22120650;43898109;18709280;41081503;39933331;22122721;20514474;37517314;47843504;41923890;58382733;40699413;49826208;32854556/answers/?pagesize=50&amp;page=1&amp;filter=-XG6tqDiasfBQHS1&amp;order=desc&amp;sort=votes&amp;todate=1601424000&amp;site=stackoverflow HTTP/1.1&quot; 200 14071
DEBUG:stacksort._meta.injector:CODE BLOCK

global count



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

def selectionSort(data):
    count = 0
    for index in range(len(data)):
        min = index
        count += 1
        # Find the index'th smallest element
        for scan in range(index + 1, len(data)):
            if (data[scan] &lt; data[min]):
                min = scan
        if min != index: # swap the elements
            data[index], data[min] = data[min], data[index]
    return count, data

count, data = selectionSort([3,4,5,2,6])
print(count, data)



DEBUG:RefactoringTool:Refactoring StackOverflow
&gt;&gt;&gt; print(sorted_list)
(100, [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99])
</code></pre>
  </div>
</div>

<div class="expandable-section">
  
    <h2>
  
    
    
    
    
    
    <button aria-expanded="false" data-expands="js-expandable-91e6012a4fda92776a6495fe78871e39">
      <span class="expandable-label">BubbleSort</span>
      <svg aria-hidden="true" focusable="false" viewBox="0 0 70.866142 70.866141">
        <g transform="translate(0 -981.5)">
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="60" width="9.8985" y="987.36" x="30.051" class="up-strut" />
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="10" width="60" y="1012.4" x="5"/>
        </g>
      </svg>
    </button>
  
    </h2>
  
  <div id="js-expandable-91e6012a4fda92776a6495fe78871e39" hidden>
    <pre><code>&gt;&gt;&gt; from stacksort import bubblesort
&gt;&gt;&gt; sorted_list = bubblesort(l)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.stackexchange.com:443
DEBUG:urllib3.connectionpool:https://api.stackexchange.com:443 &quot;GET /2.2/search/advanced/?pagesize=50&amp;page=1&amp;filter=%21b93xdWqUwqOO7m&amp;order=desc&amp;sort=relevance&amp;q=bubblesort&amp;nottagged=python-2.x&amp;tagged=python&amp;tagged=sorting&amp;todate=1601424000&amp;site=stackoverflow HTTP/1.1&quot; 200 491
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.stackexchange.com:443
DEBUG:urllib3.connectionpool:https://api.stackexchange.com:443 &quot;GET /2.2/questions/19634554;27164718;51146458;43236772;41580958;48195828;62091063;41432198;48337195;14794234;63650018;54561180;51454468;56857736;28755003;41860459;62213710;22515009;60327195;43955474;45651197;34408438;30658010;56364835;56027705;21771964;42676469;37288908;61003803;26131056;31435017;14746933;60580152;26692602;23661636;28050911;40115654;59100531;21409844;52997369/answers/?pagesize=50&amp;page=1&amp;filter=-XG6tqDiasfBQHS1&amp;order=desc&amp;sort=votes&amp;todate=1601424000&amp;site=stackoverflow HTTP/1.1&quot; 200 14796
DEBUG:stacksort._meta.injector:CODE BLOCK

list1, list2 = [1, 2, 3], [1, 4, 3]
print [index for index, (e1, e2) in enumerate(zip(list1, list2)) if e1 == e2]



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

[0, 2]



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

list1, list2 = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;], [&quot;e&quot;, &quot;d&quot;, &quot;c&quot;, &quot;b&quot;, &quot;a&quot;]
print [index for index, (e1, e2) in enumerate(zip(list1, list2)) if e1 == e2]



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

[2]



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

a, b = b, a



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

def gen_move(seq):
    from bisect import bisect_left
    out = seq[0:1]
    for elem in seq[1:]:
        index = bisect_left(out, elem)
        if seq[index] != elem:
            if index == 0:
                print &quot;Move {} before {}&quot;.format(elem, out[index])
            else:
                print &quot;Move {} after {}&quot;.format(elem, out[index - 1])
        out.insert(index, elem)
    print out



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:empty body on If
DEBUG:stacksort._meta.injector:CODE BLOCK

gen_move([1,3,2,7,6,0,4])
Move 2 after 1
Move 6 after 3
Move 0 before 1
Move 4 after 3
[0, 1, 2, 3, 4, 6, 7]

gen_move(range(10)[::-1])
Move 8 before 9
Move 7 before 8
Move 6 before 7
Move 5 before 6
Move 4 before 5
Move 3 before 4
Move 2 before 3
Move 1 before 2
Move 0 before 1
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]

gen_move(range(10))
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]



DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 2)
DEBUG:stacksort._meta.injector:CODE BLOCK

In [5]: %timeit gen_move(range(10000, 0, -1))
10000 loops, best of 3: 84 us per loop



DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 1)
DEBUG:stacksort._meta.injector:CODE BLOCK

sum(1 ln 1 + 2 ln 2 + 3 ln 3 + ..... n ln n) &lt; O(n ln n)



DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 1)
DEBUG:stacksort._meta.injector:CODE BLOCK

O(n)



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

%%cython
import numpy as np
cimport numpy as np
cimport cython
@cython.boundscheck(False) 
@cython.wraparound(False)
cpdef cython_bubblesort_numpy(long[:] np_ary):
    &quot;&quot;&quot; 
    The Cython implementation of bubble sort with NumPy memoryview.

    &quot;&quot;&quot;
    cdef int count, i, j # static type declarations
    count = np_ary.shape[0]

    for i in range(count):
        for j in range(1, count):
            if np_ary[j] &lt; np_ary[j-1]:
                np_ary[j-1], np_ary[j] = np_ary[j], np_ary[j-1]

    return np.asarray(np_ary)



DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 1)
DEBUG:stacksort._meta.injector:CODE BLOCK

with open(file, 'r') as f:
    data = [int(line.strip()) for line in f]



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

int(' 13')    # 13
int('13\t')   # 13
int('13 \n')  # 13



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

    swapped = True
    while swapped:
            swapped = False
            for i in range(0,len(lis)-1):
                    if lis[i] &gt; lis[i + 1] or lis[i] == lis[i+1]:
                        swapped = True
                        switch = lis[i]
                        lis[i] = lis[i+1]
                        lis[i+1] = switch
    return lis



DEBUG:stacksort._meta.injector:unexpected indent (&lt;unknown&gt;, line 1)
DEBUG:stacksort._meta.injector:CODE BLOCK

import random

def createRandom():
    return [random.randrange(1,100) for i in range(100)]

def bubblesort(test):
    is_sorted = False
    while not is_sorted:
        is_sorted= True
        for y in range(len(test) - 1):
            if test[y] &gt; test[y+1]:
                test[y], test[y+1] = test[y+1], test[y]
                is_sorted= False

lst = createRandom()
bubblesort(lst)
print(lst)



DEBUG:RefactoringTool:Refactoring StackOverflow
&gt;&gt;&gt; print(sorted_list)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99]
</code></pre>
  </div>
</div>

<div class="expandable-section">
  
    <h2>
  
    
    
    
    
    
    <button aria-expanded="false" data-expands="js-expandable-c65ffff3c7eced45e97bc3023256de3c">
      <span class="expandable-label">Radix Sort</span>
      <svg aria-hidden="true" focusable="false" viewBox="0 0 70.866142 70.866141">
        <g transform="translate(0 -981.5)">
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="60" width="9.8985" y="987.36" x="30.051" class="up-strut" />
          <rect style="stroke-width:0;fill:currentColor" ry="5" height="10" width="60" y="1012.4" x="5"/>
        </g>
      </svg>
    </button>
  
    </h2>
  
  <div id="js-expandable-c65ffff3c7eced45e97bc3023256de3c" hidden>
    <pre><code>&gt;&gt;&gt; from stacksort import radix_sort # Underscores are replaced with spaces in the search!
&gt;&gt;&gt; sorted_list = radix_sort(l)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.stackexchange.com:443
DEBUG:urllib3.connectionpool:https://api.stackexchange.com:443 &quot;GET /2.2/search/advanced/?pagesize=50&amp;page=1&amp;filter=%21b93xdWqUwqOO7m&amp;order=desc&amp;sort=relevance&amp;q=radix+sort&amp;nottagged=python-2.x&amp;tagged=python&amp;tagged=sorting&amp;todate=1601424000&amp;site=stackoverflow HTTP/1.1&quot; 200 834
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.stackexchange.com:443
DEBUG:urllib3.connectionpool:https://api.stackexchange.com:443 &quot;GET /2.2/questions/60968950;33901534;63276772;23049650;35419229;35395475;8279618;26418728;19781037;20207791;42145394;15539260;45647602;38979220;16396816;22841888;22844711;14444520;44477979;34023841;23050748;48039359;38011331;51667792;23046794;36398214;53956259;35317442;16029247;16046165;42697889;19736472;36548426;54341672/answers/?pagesize=50&amp;page=1&amp;filter=-XG6tqDiasfBQHS1&amp;order=desc&amp;sort=votes&amp;todate=1601424000&amp;site=stackoverflow HTTP/1.1&quot; 200 22702
DEBUG:stacksort._meta.injector:CODE BLOCK

array(randint(0, high=1&lt;&lt;32, size=10**8), uint32)



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

#include &lt;cinttypes&gt;
#include &quot;boost/sort/spreadsort/spreadsort.hpp&quot;
using namespace boost::sort::spreadsort;

extern &quot;C&quot; {
    void spreadsort(std::uint32_t* begin,  std::size_t len) {
        integer_sort(begin, begin + len);
    }
}



DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 3)
DEBUG:stacksort._meta.injector:CODE BLOCK

g++ -O3 -std=c++11 -march=native -DNDEBUG -shared -fPIC -I/tmp/boost_1_60_0 spreadsort.cpp -o spreadsort.so  



DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 1)
DEBUG:stacksort._meta.injector:CODE BLOCK

from ctypes import cdll, c_size_t, c_uint32
from numpy import uint32
from numpy.ctypeslib import ndpointer

__all__ = ['integer_sort']

# In spreadsort.cpp: void spreadsort(std::uint32_t* begin,  std::size_t len)
lib = cdll.LoadLibrary('./spreadsort.so')
sort = lib.spreadsort
sort.restype = None
sort.argtypes = [ndpointer(c_uint32, flags='C_CONTIGUOUS'), c_size_t]

def integer_sort(arr):
    assert arr.dtype == uint32, 'Expected uint32, got {}'.format(arr.dtype)
    sort(arr, arr.size)



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:No module named 'numpy'
DEBUG:stacksort._meta.injector:CODE BLOCK

from cffi import FFI
from numpy import uint32

__all__ = ['integer_sort']

ffi = FFI()
ffi.cdef('void spreadsort(uint32_t* begin,  size_t len);')
C = ffi.dlopen('./spreadsort.so')

def integer_sort(arr):
    assert arr.dtype == uint32, 'Expected uint32, got {}'.format(arr.dtype)
    begin = ffi.cast('uint32_t*', arr.ctypes.data)
    C.spreadsort(begin, arr.size)



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:No module named 'cffi'
DEBUG:stacksort._meta.injector:CODE BLOCK

lib = cdll.LoadLibrary('spreadsort.so')



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

C = ffi.dlopen('spreadsort.so')



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

cc -DBUILDING_u4_sort -I/usr/include -I./ -I../ -I../../ -I../../../ -I../../../../ -std=c99 -fgnu89-inline -O3 -g -fPIC -shared -march=native u4_sort.c -o u4_sort.so



DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 1)
DEBUG:stacksort._meta.injector:CODE BLOCK

from cffi import FFI
from numpy import uint32

__all__ = ['integer_sort']

ffi = FFI()
ffi.cdef('void u4_sort(unsigned* a, const long sz);')
C = ffi.dlopen('u4_sort.so')

def integer_sort(arr):
    assert arr.dtype == uint32, 'Expected uint32, got {}'.format(arr.dtype)
    begin = ffi.cast('unsigned*', arr.ctypes.data)
    C.u4_sort(begin, arr.size)



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:No module named 'cffi'
DEBUG:stacksort._meta.injector:CODE BLOCK

for num in unsorted:
    byte_at_offset = (num &amp; byte_check) &gt;&gt; offset*8
    buckets[byte_at_offset].append(num)



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

for num in unsorted:
    bucketappender[(num &amp; byte_check) &gt;&gt; ofs8](num)



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

(num &gt;&gt; offset*8) &amp; 0xff



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

Counting-sort(A,B,k)
  let C[0..k] be a new array
  for i = 0 to k
      C[i] = o
  for j = 1 to A.length
      C[A[j]] = C[A[j]] + 1
  for i = 1 to k
      C[i] = C[i] + C[i-1]
  for j = A.length down to 1
      B[C[A[j]]] = A[j]
      C[A[j]] = C[A[j]] - 1 



DEBUG:stacksort._meta.injector:unexpected indent (&lt;unknown&gt;, line 2)
DEBUG:stacksort._meta.injector:CODE BLOCK

www.google.com



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

python radix sort example



DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 1)
DEBUG:stacksort._meta.injector:CODE BLOCK

In []: 5/2
Out[]: 2

In []: 5.0/2
Out[]: 2.5

In []: 5.0//2
Out[]: 2.0



DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 1)
DEBUG:stacksort._meta.injector:CODE BLOCK

//  a is input array, b is working array
void RadixSort(uint32_t * a, uint32_t *b, size_t count)
{
size_t mIndex[4][256] = {0};            // count / index matrix
size_t i,j,m,n;
uint32_t u;
    for(i = 0; i &lt; count; i++){         // generate histograms
        u = a[i];
        for(j = 0; j &lt; 4; j++){
            mIndex[j][(size_t)(u &amp; 0xff)]++;
            u &gt;&gt;= 8;
        }       
    }
    for(j = 0; j &lt; 4; j++){             // convert to indices
        m = 0;
        for(i = 0; i &lt; 256; i++){
            n = mIndex[j][i];
            mIndex[j][i] = m;
            m += n;
        }       
    }
    for(j = 0; j &lt; 4; j++){             // radix sort
        for(i = 0; i &lt; count; i++){     //  sort by current lsb
            u = a[i];
            m = (size_t)(u&gt;&gt;(j&lt;&lt;3))&amp;0xff;
            b[mIndex[j][m]++] = u;
        }
        std::swap(a, b);                //  swap ptrs
    }
}



DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 1)
DEBUG:stacksort._meta.injector:CODE BLOCK

from random import randint
from math import log10
from time import clock
from itertools import chain

def splitmerge0 (ls, digit): ## python (pure!)

    seq = map (lambda n: ((n // 10 ** digit) % 10, n), ls)
    buf = {0:[], 1:[], 2:[], 3:[], 4:[], 5:[], 6:[], 7:[], 8:[], 9:[]}

    return reduce (lambda acc, key: acc.extend(buf[key]) or acc,
        reduce (lambda _, (d,n): buf[d].append (n) or buf, seq, buf), [])

def splitmerge1 (ls, digit): ## python (readable!)
    buf = [[] for i in range(10)]
    divisor = 10 ** digit
    for n in ls:
        buf[(n//divisor)%10].append(n)
    return chain(*buf)

def radixsort (ls, fn = splitmerge1):
    return list(reduce (fn, xrange (int (log10 (max(abs(val) for val in ls)) + 1)), ls))

###############################################################################
# quick sort
###############################################################################

def partition (ls, start, end, pivot_index):

    lower = start
    upper = end - 1

    pivot = ls[pivot_index]
    ls[pivot_index] = ls[end]

    while True:

        while lower &lt;= upper and ls[lower] &lt;  pivot: lower += 1
        while lower &lt;= upper and ls[upper] &gt;= pivot: upper -= 1
        if lower &gt; upper: break

        ls[lower], ls[upper] = ls[upper], ls[lower]

    ls[end] = ls[lower]
    ls[lower] = pivot

    return lower

def qsort_range (ls, start, end):

    if end - start + 1 &lt; 32:
        insertion_sort(ls, start, end)
    else:
        pivot_index = partition (ls, start, end, randint (start, end))
        qsort_range (ls, start, pivot_index - 1)
        qsort_range (ls, pivot_index + 1, end)

    return ls

def insertion_sort (ls, start, end):

    for idx in xrange (start, end + 1):
        el = ls[idx]
        for jdx in reversed (xrange(0, idx)):
            if ls[jdx] &lt;= el:
                ls[jdx + 1] = el
                break
            ls[jdx + 1] = ls[jdx]
        else:
            ls[0] = el

    return ls

def quicksort (ls):

    return qsort_range (ls, 0, len (ls) - 1)

if __name__=='__main__':
    for value in 1000, 10000, 100000, 1000000, 10000000:
        ls = [randint (1, value) for _ in range(value)]
        ls2 = list(ls)
        last = -1
        start = clock()
        ls = radixsort(ls)
        end = clock()
        for i in ls:
            assert last &lt;= i
            last = i
        print(&quot;rs %d: %0.2fs&quot; % (value, end-start))
        tdiff = end-start
        start = clock()
        ls2 = quicksort(ls2)
        end = clock()
        last = -1
        for i in ls2:
            assert last &lt;= i
            last = i
        print(&quot;qs %d: %0.2fs %0.2f%%&quot; % (value, end-start, ((end-start)/tdiff*100)))



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 13)
DEBUG:stacksort._meta.injector:CODE BLOCK

C:\temp&gt;c:\python27\python radixsort.py
rs 1000: 0.00s
qs 1000: 0.00s 212.98%
rs 10000: 0.02s
qs 10000: 0.05s 291.28%
rs 100000: 0.19s
qs 100000: 0.58s 311.98%
rs 1000000: 2.47s
qs 1000000: 7.07s 286.33%
rs 10000000: 31.74s
qs 10000000: 86.04s 271.08%



DEBUG:stacksort._meta.injector:unexpected character after line continuation character (&lt;unknown&gt;, line 1)
DEBUG:stacksort._meta.injector:CODE BLOCK

f.write('\n'.join(list_c)+'\n')



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

for s in list_c:
  f.write(s+'\n')



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

from numba import jit

@jit
def radix_loop(nbatches, batch_m_bits, bitsums, a, out):
    mask = (1 &lt;&lt; batch_m_bits) - 1
    for shift in range(0, nbatches*batch_m_bits, batch_m_bits):
        # set bit sums to zero
        for i in range(bitsums.shape[0]):
            bitsums[i] = 0

        # determine bit sums
        for i in range(a.shape[0]):
            j = (a[i] &amp; mask) &gt;&gt; shift
            bitsums[j] += 1

        # take the cumsum of the bit sums
        cumsum = 0
        for i in range(bitsums.shape[0]):
            temp = bitsums[i]
            bitsums[i] = cumsum
            cumsum += temp

        # sorting loop
        for i in range(a.shape[0]):
            j = (a[i] &amp; mask) &gt;&gt; shift
            out[bitsums[j]] = a[i]
            bitsums[j] += 1

        # prepare next iteration
        mask &lt;&lt;= batch_m_bits
        # cant use `temp` here because of numba internal types
        temp2 = a
        a = out
        out = temp2

    return a



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:No module named 'numba'
DEBUG:stacksort._meta.injector:CODE BLOCK

from scipy.sparse.coo import coo_tocsr

def radix_step(radix, keys, bitsums, a, w):
    coo_tocsr(radix, 1, a.size, keys, a, a, bitsums, w, w)
    return w, a

def scipysparse_radix_perbyte(a):
    # coo_tocsr internally works with system int and upcasts
    # anything else. We need to copy anyway to not mess with
    # original array. Also take into account endianness...
    a = a.astype('&lt;i', copy=True)
    bitlen = int(a.max()).bit_length()
    radix = 256
    work = np.empty_like(a)
    _ = np.empty(radix+1, int)
    for i in range((bitlen-1)//8 + 1):
        keys = a.view('u1')[i::a.itemsize].astype(int)
        a, work = radix_step(radix, keys, _, a, work)
    return a



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:No module named 'scipy'
DEBUG:stacksort._meta.injector:CODE BLOCK

def scipysparse_radix_hybrid(a, bbits=8, gbits=8):
    &quot;&quot;&quot;
    Parameters
    ----------
    a : Array of non-negative integers to be sorted.
    bbits : Number of bits in radix for LSB sorting.
    gbits : Number of bits in radix for MSB grouping.
    &quot;&quot;&quot;
    a = a.copy()
    bitlen = int(a.max()).bit_length()
    work = np.empty_like(a)

    # Group values by single iteration of MSB radix sort:
    # Casting to np.int_ to get rid of python BigInt
    ngroups = np.int_(2**gbits)
    group_offset = np.empty(ngroups + 1, int)
    shift = max(bitlen-gbits, 0)
    a, work = radix_step(ngroups, a&gt;&gt;shift, group_offset, a, work)
    bitlen = shift
    if not bitlen:
        return a

    # LSB radix sort each group:
    agroups = np.split(a, group_offset[1:-1])
    # Mask off high bits to not undo the grouping..
    gmask = (1 &lt;&lt; shift) - 1
    nbatch = (bitlen-1) // bbits + 1
    radix = np.int_(2**bbits)
    _ = np.empty(radix + 1, int)
    for agi in agroups:
        if not agi.size:
            continue
        mask = (radix - 1) &amp; gmask
        wgi = work[:agi.size]
        for shift in range(0, nbatch*bbits, bbits):
            keys = (agi &amp; mask) &gt;&gt; shift
            agi, wgi = radix_step(radix, keys, _, agi, wgi)
            mask = (mask &lt;&lt; bbits) &amp; gmask
        if nbatch % 2:
            # Copy result back in to `a`
            wgi[...] = agi
    return a



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

def numba_radix(a, batch_m_bits=8):
    a = a.copy()
    bit_len = int(a.max()).bit_length()
    nbatches = (bit_len-1)//batch_m_bits +1
    work = np.zeros_like(a)
    bitsums = np.zeros(2**batch_m_bits + 1, int)
    srtd = radix_loop(nbatches, batch_m_bits, bitsums, a, work)
    return srtd

a = np.random.randint(0, 1e8, 1e6)
%timeit numba_radix(a, 9)
# 10 loops, best of 3: 76.1 ms per loop
%timeit np.sort(a)
#10 loops, best of 3: 115 ms per loop
%timeit scipysparse_radix_perbyte(a)
#10 loops, best of 3: 95.2 ms per loop
%timeit scipysparse_radix_hybrid(a, 11, 6)
#10 loops, best of 3: 75.4 ms per loop



DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 11)
DEBUG:stacksort._meta.injector:CODE BLOCK

num = int(input())



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

self.num = int(input())



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

m = max(self.array) if self.array else 0



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

 &gt;&gt;&gt; 'abc' is 'abc'
 True
 &gt;&gt;&gt; x = 'ab'
 &gt;&gt;&gt; (x + 'c') is 'abc'
 False



DEBUG:stacksort._meta.injector:unexpected indent (&lt;unknown&gt;, line 1)
DEBUG:stacksort._meta.injector:CODE BLOCK

import datatable as dt
import pandas as pd
import random
from time import time
n = 10**8
src = [&quot;%x&quot; % random.getrandbits(10) for _ in range(n)]
f0 = dt.Frame(src)
p0 = pd.DataFrame(src)
f0.to_csv(&quot;test1e8.csv&quot;)

t0 = time(); f1 = f0.sort(0); print(&quot;datatable: %.3fs&quot; % (time()-t0))
t0 = time(); src.sort(); print(&quot;list.sort: %.3fs&quot; % (time()-t0))
t0 = time(); p1 = p0.sort_values(0); print(&quot;pandas:    %.3fs&quot; % (time()-t0))



DEBUG:RefactoringTool:Refactoring StackOverflow
DEBUG:stacksort._meta.injector:¯\_(ツ)_/¯
DEBUG:stacksort._meta.injector:CODE BLOCK

datatable: 1.465s / 1.462s / 1.460s (multiple runs)
list.sort: 44.352s
pandas:    395.083s



DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 1)
DEBUG:stacksort._meta.injector:CODE BLOCK

&gt; require(data.table)
&gt; DT = fread(&quot;test1e8.csv&quot;)
&gt; system.time(sort(DT$C1, method=&quot;radix&quot;))
   user  system elapsed 
  6.238   0.585   6.832 
&gt; system.time(DT[order(C1)])
   user  system elapsed 
  4.275   0.457   4.738 
&gt; system.time(setkey(DT, C1))  # sort in-place
   user  system elapsed 
  3.020   0.577   3.600 



DEBUG:stacksort._meta.injector:invalid syntax (&lt;unknown&gt;, line 1)
DEBUG:stacksort._meta.injector:CODE BLOCK

a = [[0, 1, 1],[1, 0, 0],[0,0,1]]
a = list(zip(*a))
a.sort(reverse=True)
a = list(map(list,zip(*a)))



DEBUG:RefactoringTool:Refactoring StackOverflow
&gt;&gt;&gt; print(sorted_list)
[99, 98, 97, 96, 95, 94, 93, 92, 91, 90, 89, 88, 87, 86, 85, 84, 83, 82, 81, 80, 79, 78, 77, 76, 75, 74, 73, 72, 71, 70, 69, 68, 67, 66, 65, 64, 63, 62, 61, 60, 59, 58, 57, 56, 55, 54, 53, 52, 51, 50, 49, 48, 47, 46, 45, 44, 43, 42, 41, 40, 39, 38, 37, 36, 35, 34, 33, 32, 31, 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
</code></pre>
  </div>
</div>


  </main>
  <div id="disqus-container">
  
</div>


          <footer role="contentinfo">
  
</footer>

        </div>
      </div>
    </div>
    <script src="https://davidbuckley.ca/js/prism.js"></script>



<script src="https://davidbuckley.ca/js/dom-scripts.js"></script>



    
    
  

  </body>
</html>
